<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Super Mario Top 10</title>

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>
        <span><span>S</span><span aria-hidden="true">s</span><span aria-hidden="true">s</span></span><span><span>u</span><span aria-hidden="true">u</span><span aria-hidden="true">u</span></span><span><span>p</span><span aria-hidden="true">p</span><span aria-hidden="true">p</span></span><span><span>e</span><span aria-hidden="true">e</span><span aria-hidden="true">e</span></span><span><span>r</span><span aria-hidden="true">r</span><span aria-hidden="true">r</span></span>&nbsp;<br><span><span>M</span><span aria-hidden="true">M</span><span aria-hidden="true">M</span></span><span><span>a</span><span aria-hidden="true">A</span><span aria-hidden="true">A</span></span><span><span>r</span><span aria-hidden="true">R</span><span aria-hidden="true">R</span></span><span><span>i</span><span aria-hidden="true">I</span><span aria-hidden="true">I</span></span><span><span>o</span><span aria-hidden="true">O</span><span aria-hidden="true">O</span></span>&nbsp;<br><span><span>T</span><span aria-hidden="true">T</span><span aria-hidden="true">T</span></span><span><span>o</span><span aria-hidden="true">O</span><span aria-hidden="true">O</span></span><span><span>p</span><span aria-hidden="true">P</span><span aria-hidden="true">P</span></span>&nbsp;<span><span>1</span><span aria-hidden="true">1</span><span aria-hidden="true">1</span></span><span><span>0</span><span aria-hidden="true">0</span><span aria-hidden="true">0</span></span>
    </h1>
    <main>
        <div></div>
        <ol>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario World</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario Galaxy</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario Galaxy 2</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario 64</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario Bros. 3</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario Bros.</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario Bros. 2 (JP)</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Yoshi's Island</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario 3D Land</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario Land</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario Sunshine</span>
            </li>
            <li class="hidden">
                <span><span><span><span></span></span></span></span>
                <span>Super Mario Bros. 2 (EU)</span>
            </li>
        </ol>
    </main>
    <script>
        var liCollection = document.getElementsByTagName('li');
        var audioContext;
        var samples;

        const samplePaths = ['./smw_kick.wav', './smw_riding_yoshi.wav'];

        audioContext = new AudioContext();
        setupSamples(samplePaths).then((response) => {
            samples = response;
        });

        document.body.addEventListener('click', function() {
            for (let i = liCollection.length - 1; i >= 0; i--) {
                play(i);

                if (liCollection[i].classList.contains('hidden')) {
                    liCollection[i].classList.remove('hidden');
                    break;
                }
            }
        });

        function play(index) {
            var kick = document.getElementById('kick');
            var ride = document.getElementById('ride');

            switch (index) {
                case 2:
                    playSample(samples[0], 0);
                    break;
                default:
                    playSample(samples[1], 0);
            }
        }

        async function getAudioFile(path) {
            const response = await fetch(path);
            const arrayBuffer = await response.arrayBuffer();
            const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
            return audioBuffer;
        }

        async function setupSamples(paths) {
            const audioBuffers = [];

            for (const path of paths) {
                const sample = await getAudioFile(path);
                audioBuffers.push(sample);
            }

            return audioBuffers;
        }

        function playSample(audioBuffer, time) {
            const sampleSource = audioContext.createBufferedSource();
            sampleSource.buffer = audioBuffer;
            sampleSource.connect(audioContext.destination);
            sampleSource.start(time);
        }
    </script>
</body>
</html>
